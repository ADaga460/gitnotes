#compdef clisuite

_clisuite() {
    local -a commands
    commands=(
        'init:Initialize clisuite in git repo'
        'install-hooks:Install git hooks'
        'verify:Check for orphaned attachments'
        'repair:Clean up orphaned attachments'
        'todo:Manage private todos'
        'note:Manage shared notes'
        'attach:Attach note to commit/file/dir'
        'show:Show notes for commit/file/dir'
        'sync:Sync metadata to .clisuite/'
        'pull:Pull remote metadata'
        'reset:Erase all clisuite data'
        'help:Show help message'
    )

    local -a todo_commands
    todo_commands=(
        'add:Add a todo'
        'list:List all todos'
        'done:Mark todo as done'
        'delete:Delete a todo'
    )

    local -a note_commands
    note_commands=(
        'add:Add a note'
        'edit:Edit a note'
        'list:List all notes'
        'show:Show a note'
        'delete:Delete a note'
        'search:Search notes'
    )

    local -a target_types
    target_types=(
        'commit:Attach to commit'
        'file:Attach to file'
        'dir:Attach to directory'
    )

    case $words[2] in
        todo)
            _describe 'todo command' todo_commands
            ;;
        note)
            _describe 'note command' note_commands
            ;;
        attach|show)
            case $words[3] in
                file|dir)
                    _files
                    ;;
                commit)
                    _message "commit hash or HEAD"
                    ;;
                *)
                    _describe 'target type' target_types
                    ;;
            esac
            ;;
        reset)
            _arguments '--tracked-only[Only remove tracked metadata]'
            ;;
        *)
            _describe 'clisuite command' commands
            ;;
    esac
}

_clisuite "$@"